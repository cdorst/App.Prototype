[
  {
    "$type": "ConsoleApp6.Templates.CodeGenDeclarations.Metapackage, ConsoleApp6",
    "Description": "Metapackage for EntityFrameworkCore dependencies",
    "Name": "DevOps.Code.EntityModel.Common.Metapackages.EntityFrameworkCore",
    "PackageReferences": [
      {
        "Name": "Microsoft.EntityFrameworkCore",
        "Version": "2.1.0-preview1-final"
      }
    ],
    "SameAccountDependencies": [],
    "Version": "3.0.0"
  },
  {
    "$type": "ConsoleApp6.Templates.CodeGenDeclarations.Interface, ConsoleApp6",
    "Description": "Common interface for code-generated entity types",
    "Name": "DevOps.Code.EntityModel.Common.Interfaces.Entity",
    "Version": "3.0.0",
    "Methods": [
      {
        "Comment": "Returns the unqiue identifier of the entity type",
        "Name": "GetEntityType",
        "Type": "int"
      },
      {
        "Comment": "Returns the unqiue identifier of this entity instance",
        "Name": "GetKey",
        "Type": "TKey"
      }
    ],
    "TypeParameters": [
      "TKey"
    ]
  },
  {
    "$type": "ConsoleApp6.Templates.CodeGenDeclarations.Interface, ConsoleApp6",
    "Description": "Common interface for code-generated uneditable entity types",
    "Name": "DevOps.Code.EntityModel.Common.Interfaces.StaticEntity",
    "Version": "3.0.0",
    "SameAccountDependencies": [
      "DevOps.Code.EntityModel.Common.Interfaces.Entity"
    ],
    "Methods": [
      {
        "Comment": "Returns an expression that EntityFrameworkCore uses to set a unique index on this entity type",
        "Name": "GetUniqueIndex",
        "Type": "Expression<Func<TEntity, object>>"
      }
    ],
    "TypeParameters": [
      "TEntity",
      "TKey"
    ],
    "UsingDirectives": [
      "DevOps.Code.EntityModel.Common.Interfaces.Entity",
      "System",
      "System.Linq.Expressions"
    ]
  },
  {
    "$type": "ConsoleApp6.Templates.CodeGenDeclarations.StaticFunction, ConsoleApp6",
    "Description": "Function returns the AZURE_STORAGE_CONNECTION_STRING environment variable value",
    "Name": "Cloud.Azure.Storage.Connection.Functions.GetConnectionString",
    "Version": "3.0.0",
    "Fields": [
      {
        "Comment": "Name of the environment variable containing the Azure Storage connection string",
        "DefaultValue": "\"AZURE_STORAGE_CONNECTION_STRING\"",
        "Name": "EnvironmentVariableName",
        "Type": "string"
      }
    ],
    "Methods": [
      {
        "ArrowClauseExpression": "GetEnvironmentVariable(EnvironmentVariableName)",
        "Comment": "Returns the AZURE_STORAGE_CONNECTION_STRING environment variable value",
        "Modifiers": "public static",
        "Name": "ConnectionString",
        "Type": "string"
      }
    ],
    "UsingStaticDirectives": [
      "System.Environment"
    ]
  },
  {
    "$type": "ConsoleApp6.Templates.CodeGenDeclarations.Metapackage, ConsoleApp6",
    "Description": "Metapackage for Azure ConfigurationManager dependencies",
    "Name": "Cloud.Azure.Storage.Connection.Metapackages.ConfigurationManager",
    "PackageReferences": [
      {
        "Name": "Microsoft.WindowsAzure.ConfigurationManager",
        "Version": "3.2.3"
      }
    ],
    "SameAccountDependencies": [],
    "Version": "3.0.0"
  },
  {
    "$type": "ConsoleApp6.Templates.CodeGenDeclarations.StaticFunction, ConsoleApp6",
    "Description": "Function returns an instance of Microsoft Azure ConfigurationManager using the given connection string",
    "Name": "Cloud.Azure.Storage.Connection.Functions.GetCloudStorageAccount",
    "Version": "3.0.0",
    "SameAccountDependencies": [
      "Cloud.Azure.Storage.Connection.Metapackages.ConfigurationManager"
    ],
    "Methods": [
      {
        "ArrowClauseExpression": "CloudStorageAccount.Parse(connectionString)",
        "Comment": "Returns an instance of Microsoft Azure ConfigurationManager using the given connection string",
        "Modifiers": "public static",
        "Name": "ConfigurationManager",
        "Parameters": [
          {
            "Name": "connectionString",
            "Type": "string"
          }
        ],
        "Type": "CloudStorageAccount"
      }
    ],
    "UsingDirectives": [
      "Microsoft.Azure"
    ]
  },
  {
    "$type": "ConsoleApp6.Templates.CodeGenDeclarations.StaticFunction, ConsoleApp6",
    "Description": "Function returns an instance of Microsoft Azure CloudTableClient using the given connection string",
    "Name": "Cloud.Azure.Storage.Table.Functions.GetTableClient",
    "Version": "3.0.0",
    "SameAccountDependencies": [
      "Cloud.Azure.Storage.Connection.Functions.GetCloudStorageAccount"
    ],
    "Methods": [
      {
        "ArrowClauseExpression": "ConfigurationManager(connectionString).CreateCloudTableClient()",
        "Comment": "Returns an instance of Microsoft Azure CloudTableClient using the given connection string",
        "Modifiers": "public static",
        "Name": "TableClient",
        "Parameters": [
          {
            "Name": "connectionString",
            "Type": "string"
          }
        ],
        "Type": "CloudTableClient"
      }
    ],
    "UsingDirectives": [
      "Microsoft.Azure"
    ],
    "UsingStaticDirectives": [
      "Cloud.Azure.Storage.Connection.Functions.GetCloudStorageAccount.ConfigurationManagerGetter"
    ]
  },
  {
    "$type": "ConsoleApp6.Templates.CodeGenDeclarations.StaticFunction, ConsoleApp6",
    "Description": "Function returns a reference of a Microsoft Azure CloudTable using the given connection string and table name",
    "Name": "Cloud.Azure.Storage.Table.Functions.GetTableReference",
    "Version": "3.0.0",
    "SameAccountDependencies": [
      "Cloud.Azure.Storage.Table.Functions.GetTableClient"
    ],
    "Methods": [
      {
        "ArrowClauseExpression": "TableClient(connectionString).GetTableReference(tableName)",
        "Comment": "Returns a reference of a Microsoft Azure CloudTable using the given connection string and table name",
        "Modifiers": "public static",
        "Name": "TableReference",
        "Parameters": [
          {
            "Name": "connectionString",
            "Type": "string"
          },
          {
            "Name": "tableName",
            "Type": "string"
          }
        ],
        "Type": "CloudTable"
      }
    ],
    "UsingDirectives": [
      "Microsoft.Azure"
    ],
    "UsingStaticDirectives": [
      "Cloud.Azure.Storage.Table.Functions.GetTableClient.TableClientGetter"
    ]
  },
  {
    "$type": "ConsoleApp6.Templates.CodeGenDeclarations.StaticFunction, ConsoleApp6",
    "Description": "Function returns a reference of a new or existing Microsoft Azure CloudTable using the given connection string and table name",
    "Name": "Cloud.Azure.Storage.Table.Functions.GetOrCreateTableReference",
    "Version": "3.0.0",
    "SameAccountDependencies": [
      "Cloud.Azure.Storage.Table.Functions.GetTableReference"
    ],
    "Methods": [
      {
        "Block": [
          "var table = TableReference(connectionString, tableName);",
          "table.CreateIfNotExists();",
          "return table;"
        ],
        "Comment": "Returns a reference of a new or existing Microsoft Azure CloudTable using the given connection string and table name",
        "Modifiers": "public static",
        "Name": "GetOrCreateAzureTable",
        "Parameters": [
          {
            "Name": "connectionString",
            "Type": "string"
          },
          {
            "Name": "tableName",
            "Type": "string"
          }
        ],
        "Type": "CloudTable"
      }
    ],
    "UsingDirectives": [
      "Microsoft.Azure"
    ],
    "UsingStaticDirectives": [
      "Cloud.Azure.Storage.Table.Functions.GetTableReference.TableReferenceGetter"
    ]
  },
  {
    "$type": "ConsoleApp6.Templates.CodeGenDeclarations.StaticFunction, ConsoleApp6",
    "Description": "Function returns a reference of a new or existing Microsoft Azure CloudTable using the environment's connection string and given table name",
    "Name": "Cloud.Azure.Storage.Table.Functions.GetAzureTable",
    "Version": "3.0.0",
    "SameAccountDependencies": [
      "Cloud.Azure.Storage.Table.Functions.GetOrCreateTableReference"
    ],
    "Methods": [
      {
        "ArrowClauseExpression": "GetOrCreateAzureTable(ConnectionString(), tableName)",
        "Comment": "Returns a reference of a new or existing Microsoft Azure CloudTable using the environment's connection string and given table name",
        "Modifiers": "public static",
        "Name": "AzureTable",
        "Parameters": [
          {
            "Name": "tableName",
            "Type": "string"
          }
        ],
        "Type": "CloudTable"
      }
    ],
    "UsingDirectives": [
      "Microsoft.Azure"
    ],
    "UsingStaticDirectives": [
      "Cloud.Azure.Storage.Connection.Functions.GetConnectionString.ConnectionStringGetter",
      "Cloud.Azure.Storage.Table.Functions.GetOrCreateTableReference.TableReferenceGetterOrCreator"
    ]
  },
  {
    "$type": "ConsoleApp6.Templates.CodeGenDeclarations.Class, ConsoleApp6",
    "Description": "Azure Table Storage entity representing a successfully completed AppVeyor build",
    "Name": "DevOps.Build.AppVeyor.AzureStorageTableLedger",
    "TypeName": "AppveyorBuildTable",
    "Version": "3.0.0",
    "Bases": [
      {
        "Name": "TableEntity"
      }
    ],
    "Properties": [
      {
        "Comment": "Comma-delimited string of repository dependencies in {name}|{version} format",
        "Name": "Dependencies",
        "Type": "string"
      }
    ],
    "UsingDirectives": [
      "Microsoft.WindowsAzure.Storage.Table"
    ]
  },
  {
    "$type": "ConsoleApp6.Templates.CodeGenDeclarations.StaticFunction, ConsoleApp6",
    "Description": "Function returns an instance of AppveyorBuildTable",
    "Name": "DevOps.Build.AppVeyor.AzureStorageTableLedger.Builder",
    "Version": "3.0.0",
    "SameAccountDependencies": [
      "DevOps.Build.AppVeyor.AzureStorageTableLedger"
    ],
    "Methods": [
      {
        "ArrowClauseExpression": "new AppveyorBuildTable(name, version, dependencies)",
        "Comment": "Returns an instance of AppveyorBuildTable",
        "Modifiers": "public static",
        "Name": "BuildTableEntry",
        "Parameters": [
          {
            "Name": "name",
            "Type": "string"
          },
          {
            "Name": "version",
            "Type": "string"
          },
          {
            "DefaultValue": "null",
            "Name": "dependencies",
            "Type": "string"
          }
        ],
        "Type": "AppveyorBuildTable"
      }
    ]
  },
  {
    "$type": "ConsoleApp6.Templates.CodeGenDeclarations.StaticFunction, ConsoleApp6",
    "Description": "Function returns an Azure CloudTable reference for a table named \"nuget\" in the storage account for the connection string stored in the environment",
    "Name": "DevOps.Build.AppVeyor.Functions.GetAzureTable",
    "Version": "3.0.0",
    "SameAccountDependencies": [
      "Cloud.Azure.Storage.Table.Functions.GetAzureTable",
      "DevOps.Build.AppVeyor.AzureStorageTableLedger"
    ],
    "Fields": [
      {
        "DefaultValue": "nameof(nuget)",
        "Modifiers": "private const",
        "Name": "nuget",
        "Type": "string"
      }
    ],
    "Methods": [
      {
        "ArrowClauseExpression": "GetOrCreateAzureTable(nuget)",
        "Comment": "Returns an Azure CloudTable reference for a table named \"nuget\" in the storage account for the connection string stored in the environment",
        "Modifiers": "public static",
        "Name": "GetTable",
        "Type": "CloudTable"
      }
    ],
    "UsingDirectives": [
      "Microsoft.WindowsAzure.Storage.Table"
    ],
    "UsingStaticDirectives": [
      "Cloud.Azure.Storage.Table.Functions.GetAzureTable.AzureTableGetter"
    ]
  },
  {
    "$type": "ConsoleApp6.Templates.CodeGenDeclarations.StaticFunction, ConsoleApp6",
    "Description": "Function adds the given repository build information to an Azure Storage Table ledger",
    "Name": "DevOps.Build.AppVeyor.Functions.AddBuild",
    "Version": "3.0.0",
    "SameAccountDependencies": [
      "Cloud.Azure.Storage.Table.Functions.GetAzureTable",
      "DevOps.Build.AppVeyor.AzureStorageTableLedger.Builder"
    ],
    "Methods": [
      {
        "Block": [
          "var entry = BuildTableEntry(name, version, dependencies);",
          "var operation = TableOperation.InsertOrReplace(entry);",
          "var table = GetTable();",
          "await table.ExecuteAsync(operation);"
        ],
        "Comment": "Returns an Azure CloudTable reference for a table named \"nuget\" in the storage account for the connection string stored in the environment",
        "Modifiers": "public static async",
        "Name": "AddBuildAsync",
        "Parameters": [
          {
            "Name": "name",
            "Type": "string"
          },
          {
            "Name": "version",
            "Type": "string"
          },
          {
            "DefaultValue": "null",
            "Name": "dependencies",
            "Type": "string"
          }
        ],
        "Type": "Task"
      }
    ],
    "UsingStaticDirectives": [
      "Cloud.Azure.Storage.Table.Functions.GetAzureTable.BuildTableGetter",
      "DevOps.Build.AppVeyor.AzureStorageTableLedger.Builder.AppveyorBuildTableHelper"
    ]
  },
  {
    "$type": "ConsoleApp6.Templates.CodeGenDeclarations.StaticFunction, ConsoleApp6",
    "Description": "Function gets the given repository's dependency string from the Azure Storage Table AppVeyor build ledger",
    "Name": "DevOps.Build.AppVeyor.Functions.GetBuildDependencyString",
    "Version": "3.0.0",
    "SameAccountDependencies": [
      "Cloud.Azure.Storage.Table.Functions.GetAzureTable",
      "DevOps.Build.AppVeyor.AzureStorageTableLedger"
    ],
    "Methods": [
      {
        "Block": [
          "var operation = TableOperation.Retrieve<AppveyorBuildTable>(name, version);",
          "var table = GetTable();",
          "var result = await table.ExecuteAsync(operation);",
          "if (result?.Result == null) return null;",
          "return ((AppveyorBuildTable)result.Result)).Dependencies;"
        ],
        "Comment": "Returns the given repository's dependency string from the Azure Storage Table AppVeyor build ledger",
        "Modifiers": "public static async",
        "Name": "GetDependencyStringAsync",
        "Parameters": [
          {
            "Name": "name",
            "Type": "string"
          },
          {
            "Name": "version",
            "Type": "string"
          }
        ],
        "Type": "Task<string>"
      }
    ],
    "UsingStaticDirectives": [
      "Cloud.Azure.Storage.Table.Functions.GetAzureTable.BuildTableGetter"
    ]
  }
]